---
title:	数据链路层笔记
updated: 2017-11-7 20:00
---

1.数据链路层功能：给网络层提供服务；处理传输错误；调节数据流，确保速度和延迟。

2.从网络层的数据包封装成帧(frame):内嵌的数据包、控制信息(在头)和校检和（在尾部）

3.为网络层提供三种合理的服务

	(1)无确认无连接服务，适用于两种场合：一种误码率很低的线路，错误恢复留给高层;二种实时业务语音通信.大部分局域网
	(2)有确认无连接服务，适用于不可靠的信道，如无线系统：802.11(WiFi)
	(3)有确认有连接服务,相当于向网络层提供可靠的比特流。适用于长距离且不可靠的链路，如卫星信道

4.将比特流分成离散的帧，并计算每个帧的校验和

	(1)字符计数法
	(2)带字符填充(转义)的字符定界法(PPP协议的简化形式)：DLE，STX，ETX。局限于字符传送，帧只能以8比特位为单位。
    (3)带位填充(‘0’“0”比特插入删除技术：连续5个1就多添一个0)的标记定界法:帧的起始和结束都用一个特殊的位串“01111110”，称为标记(flag)。
	(4)只适用于物理层编码有冗余的网络

5.错误检测和纠正“检错码用于高度可靠信道(如光纤)；使用纠错码的技术通常称为前向纠错(FEC),常用在频繁的信道上(无线链路)

 码字（codeword）：一个帧包括m个数据位，r个校验位，n = m + r，则此n比特单元称为n位码字。
 
 海明距离（Hamming distance）：两个码字之间不同的对应比特位数目，XOR后取1的个数即可。如果海明码距离为d，意味着需要d个1位错误才能使一个码字转化为另一个码字；为了检查出d个错（比特错），可以使用海明距离为 d + 1 的编码；为了纠正d个错，可以使用海明距离为 2d + 1 的编码，通过判断它离那个码字的码距近来恢复；2^m个合法码都用n个距离为1的非法码来表示哪一位出错，再多一位表示没有错误，则(n + 1 ) 2^m <= 2^n推出(m + r + 1) <=2^r，纠正单个错误所需要的下界。

 I.四种纠错码

	(1)海明码：位号为2的幂的位是校验位，其余是信息位；纠错：每个校验位k (k = 1, 2, 4 …)的奇偶值是否正确，若第 k 位奇偶值不对，计数器加k，计数器最后的值代表哪一位出错；使用海明码纠正突发错误：K个码字一次性发送，组成矩阵按列发送即可。
    (2)卷积码
	(3)里德所罗门码
	(4)低密度奇偶校验码

 II.三种检错码

	(1)奇偶
	(2)校检码
	(3)循环冗余校检码(Cyclic Redundancy Check, CRC):校验和（checksum）加在帧尾，使带校验和的帧的多项式能被G(x)除尽；收方接收时，用G(x)去除它，若有余数，则传输出错.由硬件实现，网络接口卡NIC(NetWork Interface Card)

6.基本的数据链路层协议
 
 I.无约束单工协议
 
 II.无错信道的单工停等协议：发方在发下一个帧之前等待一个肯定确认的协议叫做PAR或ARQ

 III.有噪声信道的单工协议:没有序号会导致无法知道是新帧还是应该丢弃的重复帧；没有序号和超时时间太短会导致ack对后面的帧进行确认。

7.滑动窗口协议

 单工变双工

 捎带确认：暂时延迟待发确认，以便附加在下一个待发数据帧的技术
 
 I.一比特滑动窗口协议:seq发送的序号，ack接受序号。对于发送窗口来说：下界的改变取决于受到的信息的ack，上界的改变取决于发送的信息的序号。
 
	一般情况，信道带宽b比特/秒，帧长度L比特，往返传输延迟R秒则信道利用率为 (L/b) / (L/b + R) = L / (L + Rb)
 
  改进：阻塞前多发w帧。w=2BD+1.带宽-延迟乘积BD(带宽*单向传输延迟，意味着传输延迟的时候能发多少帧),链路利用率<=w/(1+2BD)
 II.退后n帧重传：接受窗口为1；累计确认；发送窗口尺寸 < 序号个数（若相等则无法判断是成功还是丢失）

 III.选择重传协议：当发送窗口尺寸>=接收窗口尺寸时，接收窗口尺寸最大值为(MaxSeq+1)/2（新窗口和旧窗口没有重叠，才能分辨是重复帧还是新的帧）；可随时发送否定性确认帧NAK请求重传；

8.协议说明与验证:https://wenku.baidu.com/view/30026e0316fc700abb68fc3f.html

  协议工程：	协议说明；协议验证；协议实现；协议测试；

  形式化描述技术FDT（Formal Description Technique）/形式化方法FM（Formal Method）广泛应用于协议工程研究中。

	(1).有限状态机FSM（Finite State Machine）
	(2).Petri网模型:圆圈表示状态；线段表示事件；弧线表示输入和输出；黑点表示处于当前状态；转换即黑点的移动；
    
      一个事件的输入圆圈全部有黑点表示可以激发的，有多个激发的方案是不确定的；激发后，删除输入弧的黑点，添加输出弧的黑点。



    





